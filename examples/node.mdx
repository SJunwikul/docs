---
title: "Node.js & Express Example"
description: "Backend API server with ARES integration"
---

## Overview

This example shows how to build a RESTful API server with Express.js and ARES integration.

## Quick Start

### Setup

```bash
mkdir ares-api
cd ares-api
npm init -y
npm install express ares-sdk cors dotenv
npm install -D typescript @types/express @types/node tsx nodemon
```

### Project Structure

```
src/
├── index.ts
├── routes/
│   ├── auth.ts
│   └── ares.ts
├── middleware/
│   └── auth.ts
└── lib/
    └── ares.ts
```

## Implementation

### Main Server

```typescript src/index.ts
import express from 'express';
import cors from 'cors';
import dotenv from 'dotenv';
import aresRoutes from './routes/ares';

dotenv.config();

const app = express();
const PORT = process.env.PORT || 3000;

app.use(cors());
app.use(express.json());

// Routes
app.use('/api/ares', aresRoutes);

app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
```

### ARES Routes

```typescript src/routes/ares.ts
import express from 'express';
import { Ares } from 'ares-sdk';

const router = express.Router();

// Get user profile
router.get('/user', async (req, res) => {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');

    if (!token) {
      return res.status(401).json({ error: 'No token provided' });
    }

    const client = new Ares({ accessToken: token });
    const user = await client.user.retrieve();

    res.json({
      success: true,
      data: user,
    });
  } catch (error: any) {
    res.status(error.status || 500).json({
      success: false,
      error: error.message,
    });
  }
});

// Record usage
router.post('/usage', async (req, res) => {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');
    const { usage, credits } = req.body;

    if (!token) {
      return res.status(401).json({ error: 'No token provided' });
    }

    const client = new Ares({ accessToken: token });

    // Check credits first
    const user = await client.user.retrieve();
    if (user.credits < credits) {
      return res.status(402).json({
        error: 'Insufficient credits',
        required: credits,
        available: user.credits,
      });
    }

    // Deduct credits
    const result = await client.partner.recordUsage({
      client_id: process.env.ARES_CLIENT_ID!,
      credits,
      usage,
    });

    res.json({
      success: true,
      creditsDeducted: result.usage.credits_earned,
      creditsRemaining: user.credits - credits,
    });
  } catch (error: any) {
    res.status(error.status || 500).json({
      success: false,
      error: error.message,
    });
  }
});

export default router;
```

### Environment Variables

```bash .env
PORT=3000
ARES_CLIENT_ID=your_client_id
ARES_CLIENT_SECRET=your_client_secret
```

### Run Development Server

```bash
npm run dev
```

## Testing with cURL

```bash
# Get user
curl http://localhost:3000/api/ares/user \
  -H "Authorization: Bearer YOUR_ARES_TOKEN"

# Record usage
curl -X POST http://localhost:3000/api/ares/usage \
  -H "Authorization: Bearer YOUR_ARES_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"usage": "Test service", "credits": 10}'
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Next.js Example" href="/examples/nextjs">
    Full frontend + backend example
  </Card>
  <Card title="API Routes" href="/examples/api-routes">
    More API patterns
  </Card>
</CardGroup>
